var ObservStruct = require('observ-struct')
var ObservNodeArray = require('observ-node-array')

var types = require('types')

// get models from types
var models = {}
Object.keys(types).forEach(function (typeName) {
  var type = types[typeName]
  models[type.id] = type.model
})

function Atom () {

  // create context
  var context = {
    nodes: models,
    nodeKey: "@type",
  }

  // create atom
  var atom = ObservNodeArray(context)

  // save atom in context
  context.atom = atom

  // allow models to extend context as necessary
  Object.keys(models).forEach(function (modelName) {
    models[nodeName].extend(context)
  })

  return atom
}

//
//var contextCopy = Object.create(context)
//contextCopy.yayaya = "asdf"
//

module.exports = atom

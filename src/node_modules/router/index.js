var config = require('clientconfig');
var Path = require('path');
var pathMatch = require('path-match')();
var reverend = require('reverend');

function Router (config) {
  this.config = config;

  if (process.browser) {
    var Location = require('observ-location');
    this.location = Location(config);
  }

  this.path = ":collection/:id/:relation";
  this.pathToRoute = pathMatch(this.path);
  this.routeToPath = function (route) {
    return reverend(this.path, route)
  };
}

Router.prototype.parse = function (pathname) {

  // remove prefix from path
  pathname = pathname.replace(this.config.pathname || "/", "");
  
  // parse path into route
  var route = this.pathToRoute(pathname);

  return route;
}

Router.prototype.format = function (route) {

  // format route into path
  var pathname = this.routeToPath(route);

  // add prefix to path
  pathname = Path.join(this.config.pathname || "/", pathname);

  return pathname;
}

module.exports = new Router(config);

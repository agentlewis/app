var createStore = require('util/create-store')
var Model = require('./model')
var Collection = require('./collection')
var clone = require('lodash').clone

var store = createStore(Model, Collection)

store.loadEntity = function (entity) {
  var types = require('types')

  var type = types[entity['@type']]
  var Model = type.Model

  store.insert(new Model(entity))

  while (Model != null) {
    type = types[Model.prototype.getType()]
    if (!type || !type.store) { return }
    
    type.store.insert(clone(entity))
    
    Model = Model.__super__.constructor
  }
}

module.exports = store

var test = require('tape')

var People = require('person/collection')
var RoleType = require('role-type/model')
var Role = require('role/model')

var BaseService = require('../service')

var people
var peopleService

var apiPrefix = "http://test.holodex.is"

test("setup basic people service", function (t) {

  people = new People()

  t.ok(people)

  people.set([{
    '@id': apiPrefix + "/people/alice",
    name: "alice",
  }, {
    '@id': apiPrefix + "/people/bob",
    name: "bob",
    roles: [
      new Role({
        '@id': apiPrefix + "/roles/awesome-bob",
        type: new RoleType({
          '@id': apiPrefix + "/roleTypes/awesome",
          name: "awesome",
        }).getId(),
        agent: apiPrefix + "/people/bob",
      }).getId()
    ],
  }])

  t.equal(people.length, 2)

  peopleService = BaseService(people)

  t.end()
})

test('get model', function (t) {
  var alice = people.at(0)
  peopleService.get(alice.getId(), {}, function (err, aliceResp) {
    t.deepEqual(aliceResp, {
      "@graph": [
        alice.toJSON(),
      ]
    })
  })
  t.end()
})

test('get model and related models', function (t) {
  var bob = people.at(1)
  peopleService.get(bob.getId(), {}, function (err, bobResp) {
    t.deepEqual(bobResp, {
      "@graph": [
        bob.toJSON(),
        bob.roles.at(0).toJSON(),
        bob.roles.at(0).type.toJSON(),
      ],
    })
  })
  t.end()
})

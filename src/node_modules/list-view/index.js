var React = require('react')
var Bootstrap = require('react-bootstrap')
var r = require('r-dom')
var _ = require('lodash')
var debug = require('debug')('holodex:ui:list-view')

var Link = require('base/views/link')
var registry = require('registry')
var router = require('router')

var styles = require('./styles')

module.exports = React.createClass({

  render: function () {
  
    var model = this.props.model;

    debug('model', model)

    var content = _.map(model.relsByType, function (rels, relTypeId) {

      var relType = registry.get(relTypeId)

      debug('relType', relType, rels)

      return (
        r.section({}, [
          r.header(relType.label + ':'),

          r(Bootstrap.ListGroup, {}, rels.map(function (rel) {
            debug("rel", rel)

            return (
              r(Bootstrap.ListGroupItem, {
                styles: styles.listItem,
              }, [
                r(Link, {
                  href: router.format({ id: rel.has.id }),
                }, [
                  r.img({
                    className: "media",
                    styles: styles.listItemImage,
                    src: rel.has.image,
                  }, [
                    r.span({
                      styles: styles.listItemText,
                    }, rel.has.name),
                  ])
                ])
              ])
            )
          }))
        ])
      )
    })

    return r.div({}, content)
  },
})

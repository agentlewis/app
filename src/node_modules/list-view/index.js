var React = require('react')
var Bootstrap = require('react-bootstrap')
var r = require('r-dom')
var map = require('lodash.map')
var debug = require('debug')('holodex:ui:list-view')

var Link = require('base/views/link')
var store = require('base/store')
var router = require('router')

var style = require('./style')

module.exports = React.createClass({

  render: function () {
        
    var model = this.props.model;

    debug('model', model)

    var content = map(model.relsByType, function (rels, relTypeId) {

      var relType = store.findById(relTypeId)

      debug('relType', relType.toJSON(), "rels", rels.toJSON())

      // what is the definition of the opposite end
      var counterProp = rel.counterProp(model)
      var counterType = relType.agents[counterProp]
      // who is on the opposite end
      var counterAgent = rel[counterProp]

      return (
        r.section({
          className: "relationship-type",
          key: relType.getId(),
        }, [
          r.header(relType.label + ':'),

          r(Bootstrap.ListGroup, {
            className: "relationships",
          }, rels.map(function (rel) {
            debug("rel", rel.toJSON())

            return (
              r(Bootstrap.ListGroupItem, {
                className: "relationship",
                key: rel.getId(),
                style: style.listItem,
              }, [
                r(Link, {
                  href: router.format({ id: rel.has.id }),
                }, [
                  r.img({
                    className: "media",
                    style: style.listItemImage,
                    src: rel.has.image,
                  }),
                  r.span({
                    style: style.listItemText,
                  }, rel.has.name),
                ])
              ])
            )
          }))
        ])
      )
    })

    return r.div({}, content)
  },
})

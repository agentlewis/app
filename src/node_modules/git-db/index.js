var gitSync = require('git-sync')
var originUrl = require('git-remote-origin-url')

var readData = require('read-csv-data')

module.exports = getGraph

function getGraph (opts, cb) {
  // TODO support additional data dirs
  var cwd = process.env.CWD
  originUrl(cwd, function (err, remoteUrl) {
    if (err) { return cb(err) }
    gitSync({
      remoteUrl: remoteUrl,
      localDir: cwd,
      cronTime: opts.cronTime
    }, function () {
      readData({
        dir: opts.localDir
      }, cb)
    })
  })
}

var gitSync = require('git-sync')
var originUrl = require('git-remote-origin-url')

var readData = require('read-csv-data')

module.exports = getGraph

function getGraph (opts, cb) {
  // TODO support additional data dirs
  var cwd = process.env.CWD
  gitSync({
    remoteUrl: originUrl(cwd),
    localDir: cwd,
    cronTime: opts.cronTime
  }, function () {
    readData({
      dir: opts.localDir
    }, cb)
  })
}

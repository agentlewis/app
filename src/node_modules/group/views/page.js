var React = require('react');
var _ = require('lodash');
var debug = require('debug')("craftodex:ui:group:views:page")

var router = require('router');
var registry = require('registry');
var Group = require('group/model');

module.exports = React.createClass({

  componentDidMount: function () {
    this.props.model.on("change", function () {
      this.forceUpdate();
    }, this);
  },

  render: function () {

    var model = this.props.model;

    debug("render", model);

    console.log("model.relationshipsByType", model.hasRelsByType);

    var relsByType = _.map(model.hasRelsByType, function (rels, relTypeId) {

      var relType = registry.lookup('RelationshipType', relTypeId);
      return (
        <section>
          <div>
            { relType }
          </div>
          <div>
            {
              rels.map(function (rel) {
                return (
                  <div>{ rel.id }</div>
                );
              })
            }
          </div>
        </section>
      );
    });

    return (
      <div>
        <header>
          <a href={router.format({
            collection: "groups",
            id: model.id,
          })}>
            {model.name}
          </a>
        </header>
        { relsByType }
      </div>
    );
  },
});

var Model = require('base/model')
var Collection = require('base/collection')
var debug = require('debug')("holodex:ui:relationship:model")

var Role = require('role/model')

module.exports = Model.extend({
  modelType: "Relationship",

  props: {
    type: "link",
  },

  collections: {
    roles: Collection.extend({
      model: Role,
    }),
  },

  derived: {
    rolesByType: {
      deps: ['roles'],
      fn: function () {
        var rolesByType = {}
        this.roles.forEach(function (role) {

          // if role type is string,
          if (typeof role.type === "string") {
            // get associated role type object
            var roleType = this.type.roles.find(function (roleType) {
              return roleType.name === role.type
            })
            role.type = roleType
          }

          rolesByType[role.type.name] = role
        }, this)
        return rolesByType
      },
    },
  },

})

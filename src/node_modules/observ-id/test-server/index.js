var test = require('tape')

var Url = require('url')
var ObservId = require('../')

test('correctly gets id', function (t) {
  var prefix = Url.parse('http://test.holodex.is')
  var id = ObservId('http://test.holodex.is/me')
  t.equal(id(), 'http://test.holodex.is/me')
  t.end()
})

test('correctly prefixes id', function (t) {
  var prefix = Url.parse('http://test.holodex.is')
  var id = ObservId('me', { prefix: prefix })
  t.equal(id(), 'http://test.holodex.is/me')
  t.end()
})

test('correctly sets id', function (t) {
  var prefix = Url.parse('http://test.holodex.is')
  var id = ObservId('me', { prefix: prefix })
  id.set('you')
  t.equal(id(), 'http://test.holodex.is/you')
  t.end()
})

test('correctly listens to id', function (t) {
  var prefix = Url.parse('http://test.holodex.is')
  var id = ObservId('', { prefix: prefix })
  var vals = []
  id(function (id) {
    vals.push(id)
  })
  id.set('me')
  id.set('you')
  t.deepEqual(vals, [
    'http://test.holodex.is/me',
    'http://test.holodex.is/you',
  ])
  t.end()
})

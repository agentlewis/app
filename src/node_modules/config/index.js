var Url = require('url')
var defaults = require('lodash.defaultsdeep')
var clone = require('lodash.clone')
var defined = require('defined')

var isProd = require('util/isProd')
var config = require('../../../node_modules/config')

config.services.forEach(function (serviceName) {
  config[serviceName] = defined(config[serviceName], {})
  defaults(config[serviceName], { url: clone(config.url) })

  // HACK because of dokku:
  // unset config ports for production server
  if (isProd) {
    delete config[serviceName].url.port
  }
})

module.exports = config

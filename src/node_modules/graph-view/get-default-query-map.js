var dot = require('dot-object')

var debug = require('debug')('graph-view:get-default-query-map')

module.exports = function (model) {
  debug('get-default-query-map', model)
  var queryMap = {}
  if (model['@type'] === 'Group') {
    if (model.childGroups.length > 0) {
      dot.str(
        '/linkTypes/has-subgroup.sources.'+model.id,
        { link: '/linkTypes/has-subgroup', src: model.id, showLink: true },
        queryMap
      )
    }
    else {
      dot.str(
        '/linkTypes/includes.sources.'+model.id,
        { link: '/linkTypes/includes', src: model.id },
        queryMap
      )
    }
  }
  else {
    var inverseLinkTypes = {}
    model.linkTypesByDirection.asSource.forEach(function (linkType) {
      debug(linkType, queryMap)
      dot.str(
        linkType.id + '.sources.' + model.id,
        { link: linkType.id, src: model.id, showLink: true },
        queryMap
      )
      if (linkType.inverse) inverseLinkTypes[linkType.inverse.id] = linkType.inverse
    })

    model.linkTypesByDirection.asTarget.forEach(function (linkType) {
      if (!inverseLinkTypes[linkType.id]) {
        dot.str(
          linkType.id + '.targets.'+ model.id,
          { link: linkType.id, tgt: model.id, showLink: true },
          queryMap
        )
      }
    })
  }
    debug('queryMap', queryMap)
    return queryMap
}

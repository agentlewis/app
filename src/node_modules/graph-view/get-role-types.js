var clone = require('lodash.clone')
var keys = require('lodash.keys')
var each = require('lodash.foreach')
var store = require('base/store')
var colors = require('./colors')
var debug = require('debug')('graphview:get-role-types')

module.exports = function (roleTypes, relationships) {
  existingRoleTypes = clone(roleTypes)
  debug('existingRoleTypes', existingRoleTypes)

  var roleTypes = relationships.reduce(function (memo, relationship) {
    debug('redcing', memo, relationship)
    //role.relationship.type['@id'] === "http://localhost:3000/api/relationshipTypes/membership"
    each(relationship.roles, function (role, i) {
      var roleTypeId = role.type.getId()

      if (!memo[roleTypeId]) {
        memo[roleTypeId] = {
          active: false,
          color: colors[keys(memo).length],
          model: role.type
        }
      }
      else if (!memo[roleTypeId].model) {
        memo[roleTypeId].model = store.findById(roleTypeId)
      }
    })

    return memo
  }, existingRoleTypes)

//     var roleTypeId = role.data.type.getId()

//     var roleType = roleTypes[roleTypeId]

//     if (!roleType) {
//       roleTypes[roleTypeId] = {
//         active: false,
//         color: colors[keys(roleTypes).length],
//         model: role.data.type
//       }
//     } else if (!roleType.model) {
//       roleType.model = store.findById(roleTypeId)
//     }

  debug('roleTypes', roleTypes)
  return roleTypes
}

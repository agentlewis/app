var store = require('base/store')
var LabelMap = require('./label-map')
var debug = require('debug')('graph-view:get-tags')

module.exports = function (agentFilters) {
  var triples = []
  var contextTags = []
  debug('agentFilters', agentFilters)
  agentFilters.forEach(function (filter) {
    if (filter.agent.active) {
      var agent = store.findById(filter.agent.id)
      var triple = []
      var agentFragment = {
        filter: filter,
        type:  'Agent',
        label: agent.name
      }
      if (filter.roleType.active) { //[Stewards of] [Mikey]
        var roleTypeFragment = {
          filter: filter,
          type: 'roleType',
          label: LabelMap.agent[filter.agentType.id].withLink
        }
      var agentIndex = LabelMap.agent[filter.roleType.id].index === 1 ? 0 : 1
        triple[LabelMap.agent[filter.roleType.id].index] = roleTypeFragment
        triple[agentIndex] = agentFragment
      }
      if (filter.linkType.active) { //[People who] [steward] [Mikey]
        var agentTypeFragment = {
          filter: filter,
          type: 'agentType',
          label: LabelMap.agent[filter.agentType.id].withLink
        }
        var linkTypeFragment = {
          filter: filter,
          type: 'linkType',
          label: LabelMap.agent[filter.linkType.id].label
        }
        triple[LabelMap.agent[filter.agentType.id].index] = agentTypeFragment
        triple[LabelMap.agent[filter.linkType.id].index] = linkTypeFragment
        triple[LabelMap.agent['Agent'].index] = agentFragment
        triples.push(triple)
      }

    }
  })
  debug('triples', triples)
  return triples
}

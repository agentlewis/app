var includes = require('lodash.includes')
var reduce = require('lodash.reduce')
var debug = require('debug')('graph-view:make-links')

function makeLink (subj, relationship, obj) {
  return {
    source: subj.index,
    target: obj.index,
    model: relationship
  }
}

module.exports = function (linkTypes, graph) {
  var nodes = []
  var links = []

  debug('formatGraphData(', linkTypes, graph)

  var idToIndex = {}

  graph.forEachNode(function (node) {
    nodes.push({
      model: node.data
    })
    idToIndex[node.id] = nodes.length - 1
  })

  graph.forEachLink(function (link) {
    var linkType = linkTypes[link.data.type.getId()]

    if (linkType && linkType.active) {
      var fromIndex = idToIndex[link.fromId]
      var toIndex = idToIndex[link.toId]
      links.push({
        source: fromIndex,
        target: toIndex,
        model: link.data,
        color: linkType.color
      })
    }
  })

  debug("formatGraphData() ->", nodes, links)
  return [nodes, links]
}

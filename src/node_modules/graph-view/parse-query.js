var dot = require('dot-object')
var debug = require('debug')('parse-query')

module.exports = function (query) {
  var options = []
  var q = query.q || []

  debug('query', query, model)

  var activeTypesById = q.reduce(function (memo, q) {
    if (q.role) {
      if (q.tgt) { memo[q.role +'.target.'+ q.tgt] = q }
      if (q.src) { memo[q.role +'.source.'+ q.src] = q }
      if (q.ctx) { memo[q.role +'.context.'+ q.ctx] = q }
    }
    if (q.link) {
      if (q.tgt) { memo[q.link +'.target.'+ q.tgt] = q }
      if (q.src) { memo[q.link +'.source.'+ q.src] = q }
      if (q.ctx) { memo[q.link +'.context.'+ q.ctx] = q }
    }
    if (q.at) {
      if (q.tgt) { memo[q.at +'.target.'+ q.tgt] = q }
      if (q.src) { memo[q.at +'.source.'+ q.src] = q }
      if (q.ctx) { memo[q.at +'.context.'+ q.ctx] = q }
    }
    if (q.tgt) {
      if (q.role) { memo['targets.roles.' + q.role] = q }
      if (q.link) { memo['targets.links.' + q.link] = q }
    }


    return memo
  }, {})

  dot.object(activeTypesById)

  return activeTypesById

}

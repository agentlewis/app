var clone = require('lodash.clone')
var keys = require('lodash.keys')

var store = require('base/store')

var colors = require('./colors')

module.exports = function (linkTypes, graph) {
  linkTypes = clone(linkTypes)

  graph.forEachLink(function (link) {
    var linkTypeId = link.data.type.getId()

    var linkType = linkTypes[linkTypeId]

    if (!linkType) {
      linkTypes[linkTypeId] = {
        active: false,
        color: colors[keys(linkTypes).length],
        model: link.data.type
      }
    } else if (!linkType.model) {
      linkType.model = store.findById(linkTypeId)
    }
  })
  return linkTypes
}

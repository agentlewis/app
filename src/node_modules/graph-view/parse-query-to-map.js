var dot = require('dot-object')
var debug = require('debug')('parse-query')

module.exports = function (query) {
  var options = []
  var q = query.q || []


  debug('query', query)

  var querymap = q.reduce(function (memo, q) {
    if (q.role) {
      if (q.ctx) { memo[q.role +'.context.'+ q.ctx] = q }
    }

    if (q.link) {
      debug('query has link', q.link)
      if (q.tgt) { memo[q.link + '.targets.' + q.tgt] = q }
      if (q.src) { memo[q.link + '.sources.' + q.src] = q }
      if (q.ctx) { memo[q.link +'.contexts.'+ q.ctx] = q }
    }
    return memo
  }, {})

  dot.object(querymap)

  debug(querymap)

  return querymap

}

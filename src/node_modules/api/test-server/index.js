var test = require('tape')
var got = require('got')

test('gets graph', function (t) {
  var api = require('../')({
    data: {
      location: __dirname + '/data'
    }
  })
  var server = api.listen(5000, function (err) {
    t.error(err, 'no error')

    got('http://localhost:5000/people/alice', function (err, body) {
      t.error(err, 'no error')

      var data = JSON.parse(body)

      t.deepEqual(data, {
        '@context': {},
        '@graph': [{
          '@type': 'Person',
          '@id': 'http://localhost:3000/api/people/alice',
          name: 'Alice'
        }, {
          '@type': 'Person',
          '@id': 'http://localhost:3000/api/people/bob',
          name: 'Bob'
        }]
      })

      server.close()
      t.end()
    })
  })
})

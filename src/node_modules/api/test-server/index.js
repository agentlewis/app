var test = require('tape')
var hyperquest = require('hyperquest')
var concatStream = require('concat-stream')

test('gets graph', function (t) {
  var api = require('../')({
    data: {
      location: __dirname + '/data'
    }
  })
  var server = api.listen(5000, function (err) {
    t.error(err, 'no error')

    hyperquest('http://localhost:5000')
    .on('error', t.error)
    .pipe(concatStream(function (buf) {

      var graph = JSON.parse(buf.toString())

      t.deepEqual(graph, {
        '@context': {},
        '@graph': [{
          '@type': 'Person',
          '@id': 'http://localhost:3000/api/people/alice',
          name: 'Alice'
        }, {
          '@type': 'Person',
          '@id': 'http://localhost:3000/api/people/bob',
          name: 'Bob'
        }]
      })

      server.close()
      t.end()
    }))
  })
})

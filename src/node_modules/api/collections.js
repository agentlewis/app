var _ = require('lodash')
var debug = require('debug')("holodex:api:collections")

var collections = require('collections')
var Service = require('base/service')

// fill in any necessary defaults
_.forEach(collections, function (type, pluralName) {

  // instantiate the type store
  var store = type.store = new type.Collection()

  if (!type.service) {
    // create default service from base service
    type.service = Service(store)
  }

  // pre-fetch store data
  debug("fetching", store.collectionType, "store")
  store.fetch({
    reset: true,
    success: function () {
      debug("fetched", store.collectionType, "store")
    },
    error: function (err) {
      console.error(err.message)
      console.trace()
      throw err
    },
  })
})

module.exports = collections

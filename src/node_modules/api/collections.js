var _ = require('lodash');

// fill in any necessary defaults
var BaseService = require('base-service');
var FsStorage = require('fs-storage');

var collections = require('collections');

_.forEach(collections, function (collection, collName) {

  if (!collection.service) {
    // create default service from base service
    collection.service = new BaseService({
      type: collection.id,
      collection: collName,
      context: {},
      storage: new FsStorage({
        collection: collName,
        collections: collections,
        serialize: function (obj) {
          var yaml = require('js-yaml');
          return yaml.safeDump(obj);
        },
        deserialize: function (str) {
          var yaml = require('js-yaml');
          return yaml.safeLoad(str)
        },
        extname: ".yml",
      })
    });
  }
});

module.exports = collections;

var Model = require('base/model')

var store = require('base/store')
var roleTypes = require('role-type/store')

module.exports = Model.extend({
  typeName: "RelationshipType",
  collectionName: 'relationshipTypes',

  props: {
    name: "string",
    pluralName: "string",
    description: "string"
  },

  initialize: function (attrs, opts) {
    Model.prototype.initialize.apply(this, arguments)

    this._roleTypes = roleTypes
    .addDynamicView(this.getId() + '/roleTypes')
    .applyFind({
      relationshipType: this.getId()
    })
  },

  derived: {
    roleTypes: {
      cache: false,
      fn: function () {
        return this._roleTypes.data()
        .map(function (roleType) {
          return store.findById(roleType['@id'])
        })
      }
    }
  }
})

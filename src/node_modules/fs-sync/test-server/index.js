var test = require('tape')

var BaseCollection = require('base/collection')
var BaseModel = require('base/model')

var fsSync = require('../')

test('sync("read", collection)', function (t) {
  var prefix = "http://test.holodex.is"
  var ThingCollection = BaseCollection.extend({
    model: BaseModel.extend({
      props: {
        name: 'string',
        description: 'string',
      },
    }),
    comparator: function (model) {
      return model.name.toLowerCase()
    },
    url: function () {
      return prefix + "/things"
    },
  }, {
    sync: fsSync({
      prefix: prefix + "/things",
      location: __dirname + "/data/things",
    }),
  })

  var things = new ThingCollection()
  things.on('reset', function () {
    t.deepEqual(things.toJSON(), [{
      '@id': prefix + "/things/apple",
      name: "apple",
      description: "a tasty fruit",
    }, {
      '@id': prefix + "/things/bear",
      name: "bear",
      description: "a beautiful animal",
    }, {
      '@id': prefix + "/things/california",
      name: "California",
      description: "a lovely place",
    }])
    t.end()
  })
  things.fetch({ reset: true })
})
